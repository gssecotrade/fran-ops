<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Fran Ops · Data Quality Loterías</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:900px}
    h1{margin:0 0 8px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:600}
    .ok{background:#e8f5e9;color:#1b5e20}
    .warn{background:#fff8e1;color:#6d4c41}
    .fail{background:#ffebee;color:#b71c1c}
    pre{white-space:pre-wrap;background:#0f172a;color:#e2e8f0;padding:16px;border-radius:8px;overflow:auto}
    .card{border:1px solid #e5e7eb;border-radius:10px;padding:16px;margin:16px 0}
    a{color:#0d47a1;text-decoration:none}
    a:hover{text-decoration:underline}
    ul{margin:8px 0 0 18px}
    .meta{color:#64748b;font-size:14px}
  </style>
</head>
<body>
  <h1>Fran Ops · Data Quality (Loterías)</h1>
  <div class="meta" id="meta"></div>

  <div class="card">
    <h3>Estado</h3>
    <div id="status"></div>
  </div>

  <div class="card">
    <h3>Enlaces ZIP en Drive</h3>
    <ul id="ziplinks"><li>(sin datos)</li></ul>
  </div>

  <div class="card">
    <h3>Ficheros generados</h3>
    <ul id="files"></ul>
  </div>

  <div class="card">
    <h3>Data Quality · Report</h3>
    <pre id="dq">Cargando…</pre>
  </div>

<script>
(async function(){
  // El workflow publicará report.json en la raíz de GitHub Pages
  const resp = await fetch('./report.json', {cache:'no-cache'});
  if(!resp.ok){
    document.getElementById('dq').textContent = 'No hay report.json publicado aún.';
    return;
  }
  const data = await resp.json();

  // meta
  document.getElementById('meta').textContent =
    `Generado (UTC): ${data.generated_utc} · Run: ${data.runner||'-'}`;

  // estado
  const s = (data.status||'').toUpperCase();
  const el = document.getElementById('status');
  const b = document.createElement('span');
  b.className = 'badge ' + (s==='OK' ? 'ok' : s==='FAIL' ? 'fail' : 'warn');
  b.textContent = s || 'WARN';
  el.appendChild(b);

  // links
  const ul = document.getElementById('ziplinks');
  ul.innerHTML = '';
  (data.drive_links||[]).forEach(x=>{
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = x.url; a.target = "_blank";
    a.textContent = x.name;
    li.appendChild(a);
    ul.appendChild(li);
  });
  if(!ul.children.length){ul.innerHTML = '<li>—</li>'}

  // files
  const f = document.getElementById('files');
  f.innerHTML = '';
  if (data.manifest_path){
    const li = document.createElement('li');
    li.textContent = 'Manifest: ' + data.manifest_path;
    f.appendChild(li);
  }
  if (data.master_csv){
    const li = document.createElement('li');
    li.textContent = 'Master CSV: ' + data.master_csv;
    f.appendChild(li);
  }
  if(!f.children.length){f.innerHTML = '<li>—</li>'}

  // dq report
  document.getElementById('dq').textContent = data.dq_report || '—';
})();
</script>
</body>
</html>
